name: Telegram Notification (All Branches)

on:
  push:
    branches:
      - '**'  # triggers on all branches
  pull_request:
    types: [opened, closed]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Telegram Notification
        run: |
          # Extract commit info
          COMMIT_MSG=$(echo "${{ github.event.head_commit.message }}" | sed 's/"/\\"/g')
          BRANCH="${GITHUB_REF#refs/heads/}"
          # Use the committer's GitHub username
          USERNAME="${{ github.event.head_commit.author.username }}"

          MESSAGE="üß† *Tana Teachings Update*%0A"
          MESSAGE+="üë§ *${USERNAME}* pushed new code%0A"
          MESSAGE+="üåø Branch: *${BRANCH}*%0A"
          MESSAGE+="üìù Commit: ${COMMIT_MSG}%0A"
          MESSAGE+="üîó [View Commit](https://github.com/${{ github.repository }}/commit/${{ github.sha }})"

          # Send to Telegram
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
            -d "chat_id=${{ secrets.TELEGRAM_CHAT_ID }}" \
            -d "parse_mode=Markdown" \
            -d "text=${MESSAGE}"
